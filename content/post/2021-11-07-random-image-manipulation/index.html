---
title: Random Manipulation of a Random SmugMug Image
author: Tim Wilson
date: '2021-11-07'
slug: random-image-manipulation
categories:
  - R
tags:
  - Github Actions
  - SmugMug
  - Twitter
  - ImageMagick
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<p>This is a process that runs daily and applies a random set of transformations to a randomly selected image from my <a href="https://twilson.smugmug.com/">SmugMug site</a>. You can see a <a href="/image-randomize/">list of the results</a> that are currently available.</p>
<p>High-level, this is what happens:</p>
<p><img src="images/image-randomizer-flowchart.png" title="Image Randomizer Flowchart" width="700" /></p>
<p>Read on for details!</p>
<div id="the-motivation" class="section level2">
<h2>The Motivation</h2>
<p>I don’t think this project qualifies as generative art (or generative aRt, specifically, but check out <a href="https://art.djnavarro.net/">Danielle Navarro’s amazing work</a> or (Claus O. Wilke’s work)[<a href="https://clauswilke.com/art/" class="uri">https://clauswilke.com/art/</a>] (including his (NFTs)[<a href="https://objkt.com/profile/clauswilke/created?search=&amp;sortBy=askAsc" class="uri">https://objkt.com/profile/clauswilke/created?search=&amp;sortBy=askAsc</a>]!) or <a href="https://koenderks.github.io/aRtsy/">Koen Derks’s aRtsy package that is specifically ggplot-oriented</a>.</p>
<p>Rather, it was an opportunity for me to combine a few of my hobbies into a single project and learn along the way! Specifically, there are two hobbies: <a href="https://twilson.smugmug.com/">nature photography</a> and R. When it comes to doing programmatic (machine?) manipulation of photos, this is nothing nearly as involved as the neural nets employed by (Deep Dream Generator)[<a href="https://deepdreamgenerator.com/" class="uri">https://deepdreamgenerator.com/</a>], although, hey, this is me combined with Starry Night in an AI’s dream:</p>
<p><img src="images/tim_wilson_starry_night.jpeg" title="Tim Wilson Dreamt of with Starry Night" width="400" /></p>
<p>The learning that came along with the effort was:</p>
<ul>
<li><strong>Cloud-based automation:</strong> I initially thought this would be Docker and the Google Cloud Platform, but, ultimately, it wound up just being GitHub Actions, which turned out to be cheaper and, arguably, simpler</li>
<li><strong>Using APIs without a platform-specific package:</strong> I’ve know that (<code>httr</code>)[<a href="https://httr.r-lib.org/" class="uri">https://httr.r-lib.org/</a>] is the go-to package for working with any REST API, but I had never used it directly from authentication through GETs</li>
<li><strong>Image manipulation:</strong> Raster-based images are, at their core, just matrices, with each pixel being represented by a value in the matrix. It turns out that it’s fun to think about exactly what the underlying matrix manipulation is that adds different effects to an image</li>
<li><strong>Static site generation:</strong> This wound up being (Hugo)[<a href="https://gohugo.io/" class="uri">https://gohugo.io/</a>] along with (Netlify)[<a href="https://www.netlify.com/" class="uri">https://www.netlify.com/</a>] (with GitHub along the way)</li>
</ul>
<p>Somewhere in all of that, (GitHub Secrets)[<a href="https://docs.github.com/en/actions/security-guides/encrypted-secrets" class="uri">https://docs.github.com/en/actions/security-guides/encrypted-secrets</a>] to securely store API tokens for SmugMug and Twitter!</p>
<p>Below, I’ve broken down the different components of the work, linking to specific resources for additional details. But, the full set of code really comes down to:</p>
<ul>
<li><p>A (folder in the GitHub repository that serves this site)[<a href="https://github.com/gilliganondata/gilliganondata_site/tree/main/content/image-randomize" class="uri">https://github.com/gilliganondata/gilliganondata_site/tree/main/content/image-randomize</a>] (<code>master.R</code> is really the key file; it sources all the other files)</p></li>
<li><p>The (GitHub Action workflow YAML)[<a href="https://github.com/gilliganondata/gilliganondata_site/blob/main/.github/workflows/daily-image-run.yaml" class="uri">https://github.com/gilliganondata/gilliganondata_site/blob/main/.github/workflows/daily-image-run.yaml</a>] that is also part of the repository that serves this site</p></li>
</ul>
<p>We can dig in a little deeper to explain the what’s what there.</p>
</div>
<div id="pulling-a-random-image-from-smugmug" class="section level2">
<h2>Pulling a Random Image from SmugMug</h2>
<ul>
<li>Key package: <code>httr</code></li>
<li>Even though it’s pulling public data, had to generate an API token</li>
<li>That led to learning how to use GitHub Secrets to store tokens safely in a GitHub repo (this worked amazingly smoothly; <code>Sys.getenv()</code> just worked!)</li>
<li>Had to pull a list of all of the albums and then cycle through all of the albums to get all of the images</li>
<li>Then, had a data frame with all of the images and…simply randomly selected one.</li>
<li>[Link to the specific .R file]</li>
</ul>
</div>
<div id="creating-and-applying-a-random-set-of-transformations" class="section level2">
<h2>Creating and Applying a Random Set of Transformations</h2>
</div>
<div id="creating-a-web-page-with-the-beforeafter" class="section level2">
<h2>Creating a Web Page with the Before/After</h2>
</div>
<div id="tweeting-the-result" class="section level2">
<h2>Tweeting the Result</h2>
</div>
<div id="automating-all-of-this" class="section level2">
<h2>Automating All of This</h2>
<p>We’ll get to writing out the details later, but this is really about making a few different things work together to see what happens:</p>
<ul>
<li>Pulling an image from a SmugMug site at random (via the SmugMug API)</li>
<li>Applying a random number of manipulations in a random order with random settings to that image</li>
<li>Publishing the before and after as a new web page on this site</li>
<li>Adding a link to that page to a master web page listing links to all of the times it’s been run</li>
<li>Tweeting the before/after in a single tweet and linking back to that web page</li>
<li>Doing the above on a daily basis via Github actions</li>
</ul>
</div>
